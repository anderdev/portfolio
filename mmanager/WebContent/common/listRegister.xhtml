<ui:composition xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        template="../template/templateAPP.xhtml" >
        
        
        <ui:define name="contentAPP">
        	<h:form prependId="false" id="formSearchRegister">
        	
        		<h:outputText value="#{messages['lb_search_register_list']}" styleClass="boxTitle"/>

				<p:growl id="msg" showDetail="true" showSummary="false" autoUpdate="true" sticky="true" /> 

				<h:panelGroup styleClass="searchContent">
	        		<div align="center" >

		        		<h:panelGrid columns="2" width="100%" border="0" columnClasses="alignLeft,alignRight">
			        		<h:panelGroup>
			        			<h:panelGrid columns="3" width="30%" border="0" columnClasses=",,,">
			        				<p:selectOneMenu value="#{registerMBean.searchRegister.creditCard.id}" label="#{messages['lb_creditcard_']}" >
							            <f:selectItem itemLabel="#{messages['lb_creditcard_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.creditCards}"  var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>
									<p:selectOneMenu value="#{registerMBean.searchRegister.typeClosure.id}" label="#{messages['lb_type_closure_']}" >
							            <f:selectItem itemLabel="#{messages['lb_type_closure_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.typeClosures}"  var="desc" itemLabel="#{desc.type}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>
									<p:selectOneMenu value="#{registerMBean.searchRegister.currency.id}" label="#{messages['lb_currency_']}"  >
							            <f:selectItem itemLabel="#{messages['lb_currency_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.currencies}"  var="desc" itemLabel="#{desc.acronymn}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>
							    </h:panelGrid>

			        			<h:panelGrid columns="8"  border="0" columnClasses="column90,column90,column90,column90,column90,column90,column100percentC,column90" >
			        				<p:selectOneMenu value="#{registerMBean.searchRegister.description.id}" label="#{messages['lb_description_']}"  >
							            <f:selectItem itemLabel="#{messages['lb_description_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.creditsDebits}"  var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>

							        <p:selectOneMenu value="#{registerMBean.searchRegister.group.id}" label="#{messages['lb_group_']}" >
							            <f:selectItem itemLabel="#{messages['lb_group_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.groups}"  var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>

							        <p:selectOneMenu value="#{registerMBean.searchRegister.superGroup.id}" label="#{messages['lb_super_group_']}" >
							            <f:selectItem itemLabel="#{messages['lb_super_group_']}" itemValue="" />
							            <f:selectItems value="#{registerMBean.superGroups}"  var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>  
							        </p:selectOneMenu>

							        <h:panelGroup>
								        <p:calendar id="from" value="#{registerMBean.searchRegister.strDate}"  
								        	maxlength="10"
											pattern="dd/MM/yyyy"
											size="7"
											yearRange="1950:2050"/>		
							        	<p:watermark for="from" value="#{messages['lb_from']}" style="width:100px"/>
							        </h:panelGroup>

							        <h:panelGroup>
							        	<p:calendar id="to"  value="#{registerMBean.searchRegister.date}"  
								        	maxlength="10"
											pattern="dd/MM/yyyy"
											size="7"
											yearRange="1950:2050"/>	
							      	  <p:watermark for="to" value="#{messages['lb_to']}" />
							      	</h:panelGroup>

							      	<p:commandButton value="#{messages['lb_search_']}" styleClass="button" ajax="true" 
    												 action="#{registerMBean.search}" update="registerList" />
					      			<h:outputText value=""/>
					      			<p:commandButton value="#{messages['lb_delete']}" styleClass="button" onclick="confirmDelete.show()" />
					            </h:panelGrid>
			        		</h:panelGroup>
					    </h:panelGrid>

					    <p:dataTable var="reg" value="#{registerMBean.registerSearchList}" style="width:100%" id="registerList"
				    		paginatorAlwaysVisible="false" paginator="true" emptyMessage="#{messages['lb_empty_list']}"
				    		rows="10" rowKey="#{reg}"
				    		paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"  
                 			rowsPerPageTemplate="5,10,15,25,50"
                 			paginatorPosition="top" 
                 			selection="#{registerMBean.selectedRegister}" >
                 			
                 			<p:column selectionMode="multiple" style="width:3%;text-align:center" disabledSelection="#{reg.closed}"/>
                 			
                 			<f:facet name="footer">
                 				<h:panelGroup rendered="#{registerMBean.loadSearchFooter}">
					    	 		<div style="text-align:right;">
					    	 			<h:panelGrid columns="3" styleClass="gridNoLayout" columnClasses=",column90,column4percent" rendered="#{registerMBean.debitTotal gt 0}">
						    	 			<h:outputText value="#{messages['lb_totalDebit_']}" />
						    	 			<h:outputText value="#{registerMBean.debitTotal}" style="color:red;" >
						    	 				<f:convertNumber pattern="###,##0.00"/>
						    	 			</h:outputText>
						    	 			<h:outputText value="" />
					    	 			</h:panelGrid>
					    	 			<h:panelGrid columns="3" styleClass="gridNoLayout" columnClasses=",column90,column4percent" rendered="#{registerMBean.creditTotal gt 0}">
						    	 			<h:outputText value="#{messages['lb_totalCredit_']}" />
						    	 			<h:outputText value="#{registerMBean.creditTotal}" style="color:blue;">
						    	 				<f:convertNumber pattern="###,##0.00"/>
						    	 			</h:outputText>
						    	 			<h:outputText value="" />
					    	 			</h:panelGrid>
					    	 			<h:panelGrid columns="3" styleClass="gridNoLayout" columnClasses=",column90,column4percent" rendered="#{registerMBean.searchTotal gt 0 or registerMBean.searchTotal lt 0}">
						    	 			<h:outputText value="#{messages['lb_total_']}" />
						    	 			<h:outputText value="#{registerMBean.searchTotal}" >
						    	 				<f:convertNumber pattern="###,##0.00"/>
						    	 			</h:outputText>
						    	 			<h:outputText value="" />
					    	 			</h:panelGrid>
					                </div>
				                </h:panelGroup>
				            </f:facet>
                 			

					        <p:column>
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_description_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.description.description}" />
					        </p:column>

					        <p:column>
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_group_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.group.description}" />
					        </p:column>

					        <p:column>
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_super_group_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.superGroup.description}" />
					        </p:column>

					        <p:column style="width:120px;text-align:center;">
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_creditcard_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.creditCard.name}" />
					        </p:column>

					        <p:column style="width:120px;text-align:center;">
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_type_closure_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.typeClosure.type}" />
					        </p:column>

					        <p:column sortBy="#{reg.date}" style="width:100px;text-align:center;">
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_date_']}" />
					            </f:facet>
					            <h:outputText value="#{reg.date}">
					            	<f:convertDateTime pattern="dd/MM/yyyy" />
					            </h:outputText>
					        </p:column>

					        <p:column style="width:90px;text-align:center;">
					            <f:facet name="header">
					                <h:outputText value="#{messages['lb_amount_']}" />
					            </f:facet>
					            <div align="right">
						            <h:outputText value="#{reg.amount}" styleClass="debit" rendered="#{reg.typeAccount.description eq 'Debit' or reg.typeAccount.description eq 'Debito'}">
						            	<f:convertNumber pattern="###,##0.00"/>
						            </h:outputText>
						            <h:outputText value="#{reg.amount}" styleClass="credit" rendered="#{reg.typeAccount.description eq 'Credit' or reg.typeAccount.description eq 'Credito'}">
						            	<f:convertNumber pattern="###,##0.00"/>
						            </h:outputText>
					            </div>
					        </p:column>

					        <p:column style="width:5%">
					       		<p:commandLink action="#{registerMBean.edit(true)}" id="editButton" ajax="true" immediate="true" >
					        		<f:setPropertyActionListener value="#{reg}" target="#{registerMBean.register}" />  
									<p:graphicImage value="#{messages['img_update']}" style="border: 0px" />
								</p:commandLink>
					        </p:column>
					    </p:dataTable>
					</div>	
				</h:panelGroup>
				<p:confirmDialog message="#{messages['lb_multiple_exclusion']}" header="#{messages['lb_header_confirmation']}" severity="alert" widgetVar="confirmDelete">  
	            	<div align="center">
				        <p:commandButton value="#{messages['lb_yes']}" update="registerList" oncomplete="confirmDelete.hide()" action="#{registerMBean.delete}"/>  
				        <p:commandButton value="#{messages['lb_no']}" onclick="confirmDelete.hide()" type="button" />   
	                </div> 
	    		</p:confirmDialog>  
    		</h:form>
    		
    		<p:dialog header="#{messages['lb_header_confirmation']}" widgetVar="confirmation" modal="true" id="confirmationDialog" appendTo="@(body)" closable="false" resizable="false">
				<h:form id="formConfirmation">  
	             	<div align="center">
	             		<p:panel styleClass="boldFont" id="messageParcels">
	             			<p:outputLabel value="#{registerMBean.nrParcels}"/>
	             		</p:panel>	
	             		<h:panelGrid columns="3" >
				        	<p:commandButton value="#{messages['lb_edit_all']}" update=":formRegister" oncomplete="confirmation.hide()" action="#{registerMBean.editSearch(true)}"/>  
				        	<p:commandButton value="#{messages['lb_edit_just']}" update=":formRegister" oncomplete="confirmation.hide()" action="#{registerMBean.editSearch(false)}"/>
				        	<p:commandButton value="#{messages['lb_back']}" oncomplete="confirmation.hide()" />  
				        </h:panelGrid>   
	                </div> 
                </h:form>
    		</p:dialog> 
    		
    		<p:dialog header="#{messages['lb_maintain_register']}" resizable="false" widgetVar="registerModal" modal="true" appendTo="@(body)" closable="false" >
    			<h:form id="formRegister"> 
			    	<h:panelGroup id="panel">
			       		<h:panelGrid columns="2" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column285" border="0" >

							<h:outputText value="#{messages['lb_date']}"  />
							<p:calendar showButtonPanel="true" navigator="true" showOn="button"
								value="#{registerMBean.register.date}"  label="#{messages['lb_date_']}"
								required="true" 
								id="calendar"
								readonlyInput="false"
							    maxlength="10"
								pattern="dd/MM/yyyy" 
								disabled="#{registerMBean.register.id != null}"/>

					        <h:outputText value="#{messages['lb_description']}" />
				            <p:autoComplete label="#{messages['lb_description_']}" dropdown="true" value="#{registerMBean.register.description.description}" completeMethod="#{registerMBean.debitComplete}" rendered="#{registerMBean.loadDebits}" required="true" style="width:90%">
				            	<p:ajax event="itemSelect" process="@this" listener="#{registerMBean.checkDebitDescription}" />
				            	<p:ajax process="@this" listener="#{registerMBean.checkDebitDescription}" />
				            </p:autoComplete>  

					        <p:autoComplete label="#{messages['lb_description_']}" dropdown="true" value="#{registerMBean.register.description.description}" completeMethod="#{registerMBean.creditComplete}" rendered="#{registerMBean.loadCredits}" required="true" style="width:90%">
				            	<p:ajax event="itemSelect" process="@this" listener="#{registerMBean.checkCreditDescription}" />
				            	<p:ajax process="@this" listener="#{registerMBean.checkCreditDescription}" />
				            </p:autoComplete>  

					        <h:outputText value="#{messages['lb_group']}" />
					        <p:autoComplete label="#{messages['lb_group_']}" dropdown="true" value="#{registerMBean.register.group.description}" completeMethod="#{registerMBean.groupComplete}" required="true" style="width:90%">
				            	<p:ajax event="itemSelect" listener="#{registerMBean.checkGroupDescription}" />
				            	<p:ajax process="@this" listener="#{registerMBean.checkGroupDescription}" />
				            </p:autoComplete> 

					        <h:outputText value="#{messages['lb_super_group']}" />
					        <p:autoComplete label="#{messages['lb_super_group_']}" dropdown="true" value="#{registerMBean.register.superGroup.description}" completeMethod="#{registerMBean.superGroupComplete}" required="true" style="width:90%">
				            	<p:ajax event="itemSelect" process="@this" listener="#{registerMBean.checkSuperGroupDescription}" />
				            	<p:ajax process="@this" listener="#{registerMBean.checkSuperGroupDescription}" />
				            </p:autoComplete> 

					        <h:outputText value="#{messages['lb_creditcard']}" rendered="#{registerMBean.loadDebits}"/>
							<p:selectOneMenu value="#{registerMBean.register.creditCard.id}" label="#{messages['lb_creditcard_']}" rendered="#{registerMBean.loadDebits}" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{registerMBean.creditCards}"  var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>  
					        </p:selectOneMenu>

						</h:panelGrid>

						<h:panelGrid columns="4" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column80,column80rightAlign,column80" border="0">
							<h:outputText value="#{messages['lb_type_closure']}" />
							<p:selectOneMenu value="#{registerMBean.register.typeClosure.id}" label="#{messages['lb_type_closure_']}" required="true" >
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{registerMBean.typeClosures}"  var="desc" itemLabel="#{desc.type}" itemValue="#{desc}"/>  
					        </p:selectOneMenu>

					        <h:outputText value="#{messages['lb_currency']}" />
							<p:selectOneMenu value="#{registerMBean.register.currency.id}" label="#{messages['lb_currency_']}" required="true" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{registerMBean.currencies}"  var="desc" itemLabel="#{desc.acronymn}" itemValue="#{desc}"/>  
					        </p:selectOneMenu>

							<h:outputText value="#{messages['lb_parcels']}" />
							<p:inputText  label="#{messages['lb_parcels_']}" disabled="true" styleClass="numeric" maxlength="3" value="#{registerMBean.register.numberParcel}" style="width:25px;text-align:right;" />

							<h:outputText value="#{messages['lb_amount']}" />
							<p:inputText id="amount"  label="#{messages['lb_amount_']}" required="#{!registerMBean.register.closed}" maxlength="10" disabled="#{registerMBean.register.closed}"  value="#{registerMBean.register.amount}" style="width:80px;text-align:right;" />
						</h:panelGrid>

						<br />

						<div align="center">
							<p:commandButton value="#{messages['lb_post']}" id="post" action="#{registerMBean.saveFromSearch}" oncomplete="registerModal.hide()" ajax="false" update=":formSearchRegister" styleClass="button"/>  
							<p:commandButton value="#{messages['lb_back']}" oncomplete="registerModal.hide()" immediate="true" styleClass="button" action="#{registerMBean.cancelEditSearch}"/>
						</div>
					</h:panelGroup>
				</h:form>
			</p:dialog>		
        </ui:define>
</ui:composition>