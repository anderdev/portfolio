<ui:composition xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        template="../template/templateAPP.xhtml" >
        	
		<ui:define name="contentAPP">
        	<h:form prependId="false" id="formPlanning">
	        	<h:outputText value="#{messages['lb_planning_registration']}" styleClass="boxTitle" />

				<p:growl id="msg" showDetail="true" showSummary="false" autoUpdate="true" sticky="true" /> 
				
				<div class="listPlanning">
					<div align="right" class="newPlanning">
					
						<h:panelGrid columns="2" width="100%" border="0" columnClasses="alignLeft,alignRight" rendered="#{!planningMBean.showForm}">
			        		<p:commandButton value="#{messages['lb_new_item']}" 
			        			action="#{planningMBean.newPlanningGroup}"  
			        			styleClass="button" 
			        			update=":planningGroup" 
			        			id="newButton"
			        			rendered="#{planningMBean.showButtonItem}"
			        			oncomplete="newPlanningModal.show()" >
			        		</p:commandButton>
			        		<p:commandButton value="#{messages['lb_new_tab']}" update=":formPlanning" immediate="true" id="newTab" ajax="true" styleClass="button" action="#{planningMBean.newPlanning}"/>
					    </h:panelGrid>
					    
	        			<h:panelGroup id="tabForm" rendered="#{planningMBean.showForm}">
							<h:panelGrid columns="4" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column80" border="0">
								<h:outputText value="#{messages['lb_description']}" />
								<p:inputText id="planDescription" 
											label="#{messages['lb_description_']}" 
											required="true" 
											maxlength="10"  
											value="#{planningMBean.planning.description}" 
											style="width:80px;text-align:right;" >
											<p:watermark for="planDescription" value="#{messages['lb_year']}"/>
								</p:inputText>
								<p:commandButton value="#{messages['lb_post']}" id="post" action="#{planningMBean.saveTab}" ajax="true" update=":formPlanning" styleClass="button" />  
								<p:commandButton value="#{messages['lb_cancel']}" update=":formPlanning" immediate="true" id="back" ajax="true"  styleClass="button" action="#{planningMBean.cancelTab}"/>
							</h:panelGrid>
						</h:panelGroup>
					</div>
					
					<p:tabView id="tabView" var="plan" value="#{planningMBean.planningList}" style="height:430px;" activeIndex="#{planningMBean.activedIndex}">
						<p:ajax event="tabChange" listener="#{planningMBean.onChange}" update="tabView"/> 
						<p:tab id="planningItemTab" title="#{plan.description}" >   
						    <p:dataTable var="planGroup" value="#{plan.plannigGroupList}" style="width:100%" id="planningGroupList"
					    		emptyMessage="#{messages['lb_empty_list']}" rows="10" rowKey="#{planGroup}" 
					    		selection="#{planningMBean.selectedPlanningGroup}">
					    		
					    		<p:column width="1%"> <!-- oncomplete="confirmDelete.show()" -->
									<p:commandLink action="#{planningMBean.delete}"  ajax="true" id="deleteButton" immediate="true" update="planningGroupList">
										<f:setPropertyActionListener value="#{plan}" target="#{planningMBean.selectedPlanning}" />
						        		<f:setPropertyActionListener value="#{planGroup}" target="#{planningMBean.selectedPlanningGroup}" />
										<p:graphicImage value="#{messages['img_delete']}" style="border: 0px" />
									</p:commandLink>
					            </p:column>
					    		
					    		<p:column style="width:15%"> 
					    			 <h:outputText value="#{planGroup.description.description}"/> 
					    		</p:column>
					    		
					    		<p:column style="width:85%">
						    		<p:dataGrid value="#{planGroup.plannigItemList}" var="item" columns="12">
					    				<p:commandLink action="#{planningMBean.newPlanningItem}" oncomplete="newPlanningItemModal.show()" ajax="true" immediate="true" styleClass="link" update=":planningItem">
							        		<f:setPropertyActionListener value="#{item}" target="#{planningMBean.selectedPlanningItem}" />
							        		<f:setPropertyActionListener value="#{planGroup}" target="#{planningMBean.selectedPlanningGroup}" />
							        		<div class="column60R" >
							        			<h:outputText value="#{item.amount}" styleClass="debit" rendered="#{planGroup.typeAccount.description eq 'Debit' or planGroup.description.typeAccount.description eq 'Debito'}">
									            	<f:convertNumber pattern="###,##0.00"/>
									            </h:outputText>
									            <h:outputText value="#{item.amount}" styleClass="credit" rendered="#{planGroup.typeAccount.description eq 'Credit' or planGroup.description.typeAccount.description eq 'Credito'}">
									            	<f:convertNumber pattern="###,##0.00"/>
									            </h:outputText>
											</div>
										</p:commandLink>
						    		</p:dataGrid>
					    		</p:column>
						    </p:dataTable>
						    
						    <p:confirmDialog message="#{messages['lb_multiple_exclusion']}" header="#{messages['lb_header_confirmation']}" severity="alert" widgetVar="confirmDelete">  
				            	<div align="center">
				            		<h:outputText  value="#{planningMBean.selectedPlanning.description}"/>
				            		<h:outputText  value="#{planningMBean.selectedPlanningGroup.description.description}"/>
							        <p:commandButton value="#{messages['lb_yes']}" update="planningGroupList" oncomplete="confirmDelete.hide()" action="#{planningMBean.delete}"/>  
							        <p:commandButton value="#{messages['lb_no']}" onclick="confirmDelete.hide()" type="button" />   
				                </div> 
				    		</p:confirmDialog>  
						</p:tab>
					</p:tabView>
				</div>
			</h:form>
			
			<p:dialog header="#{messages['lb_planning_amount_registration']}" resizable="false" widgetVar="newPlanningItemModal" modal="true" appendTo="@(body)" height="170" width="380">  
			    <h:form prependId="false" id="planningItem">
			    	<script type="text/javascript">
					$(function() {
					    $('#planItemAmount').numeric();
					    $('#planItemAmount').maskMoney();
					  });
					</script>
			    	<h:panelGroup id="panelItem">
			    		<h:panelGrid columns="2" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column185R" border="0" >
			    			<h:outputText value="#{messages['lb_description']}" />
			    			<h:outputText value="#{planningMBean.selectedPlanningGroup.description.description}" />
			    			<h:outputText value="#{messages['lb_month']}" />
			    			<h:outputText value="#{planningMBean.selectedMonth}" />
			    			<h:outputText value="#{messages['lb_amount_last_month']}" />
			    			<h:panelGroup>
			    				<div align="right">
			    					<h:outputText value="9999.99">
						            	<f:convertNumber pattern="###,##0.00"/>
						            </h:outputText>
			    				</div>
			    			</h:panelGroup>
			    			<h:outputText value="#{messages['lb_amount']}" />
			    			<p:inputText id="planItemAmount" value="#{planningMBean.selectedPlanningItem.amount}" maxlength="10" style="width:80px;text-align:right;" />
			    		</h:panelGrid>
			    	
			    		<br />
						<div align="center">
							<p:commandButton value="#{messages['lb_post']}" id="postItem" action="#{planningMBean.saveItem}" oncomplete="if (args &amp;&amp; !args.validationFailed) newPlanningItemModal.hide();" ajax="true" update=":formPlanning" styleClass="button"/>  
							<p:commandButton value="#{messages['lb_back']}" update=":formPlanning" immediate="true" id="backItem" oncomplete="newPlanningItemModal.hide()" ajax="true"  styleClass="button" />
						</div>
			    	</h:panelGroup>
			    </h:form>
			</p:dialog>
			
			<p:dialog header="#{messages['lb_planning_registration']}" resizable="false" widgetVar="newPlanningModal" modal="true" appendTo="@(body)" height="150" width="480">  
			    <h:form prependId="false" id="planningGroup">
			    	<h:panelGroup id="panel">
	       				<br />
			       		<h:panelGrid columns="2" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column285" border="0" >
			       		
			       			<h:outputText value="#{messages['lb_typeAccount']}" />
							<p:selectOneMenu value="#{planningMBean.planningGroup.typeAccount.id}" label="#{messages['lb_typeAccount_']}" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{planningMBean.typeAccounts}" var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>
					            <p:ajax update="descriptions" event="change" listener="#{planningMBean.loadGroups}"/>  
					        </p:selectOneMenu>
		
					        <h:outputText value="#{messages['lb_description']}"/>
							<p:selectOneMenu id="descriptions" value="#{planningMBean.planningGroup.description.id}" label="#{messages['lb_description_']}" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{planningMBean.groups}"  var="desc" itemLabel="#{desc.description}" itemValue="#{desc}" />
					        </p:selectOneMenu>
					        
						</h:panelGrid>
						
						<br />
						<div align="center">
							<p:commandButton value="#{messages['lb_post']}" id="postGroup" action="#{planningMBean.saveGroup}" oncomplete="if (args &amp;&amp; !args.validationFailed) newPlanningModal.hide();" ajax="true" update=":formPlanning" styleClass="button"/>  
							<p:commandButton value="#{messages['lb_back']}" update=":formPlanning" immediate="true" id="backGroup" oncomplete="newPlanningModal.hide()" ajax="true"  styleClass="button" />
						</div>
					</h:panelGroup>
				</h:form>
			</p:dialog>
		</ui:define>
</ui:composition>
