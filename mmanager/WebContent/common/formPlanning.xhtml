<ui:composition xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        template="../template/templateAPP.xhtml" >
        	
		<ui:define name="contentAPP">
        	<h:form prependId="false" id="formPlanning">
        	<script type="text/javascript">
					$(function() {
					    $('#planDescription').numeric();
					    $('.column100percentR').maskMoney();
					  });
					</script>
	        	<h:outputText value="#{messages['lb_planning_registration']}" styleClass="boxTitle" />

				<p:growl id="msg" showDetail="true" showSummary="false" autoUpdate="true" sticky="true" /> 
				
				<div class="listPlanning">
					<div align="right" class="newPlanning">
					
						<h:panelGrid columns="2" width="100%" border="0" columnClasses="alignLeft,alignRight" rendered="#{!planningMBean.showForm}">
			        		<p:commandButton value="#{messages['lb_new_item']}" 
			        			action="#{planningMBean.newItem}"  
			        			styleClass="button" 
			        			update=":planningItem" 
			        			id="newButton"
			        			oncomplete="newPlanningModal.show()" >
			        		</p:commandButton>
			        		<p:commandButton value="#{messages['lb_new_tab']}" update=":formPlanning" immediate="true" id="newTab" ajax="true" styleClass="button" action="#{planningMBean.newTab}"/>
					    </h:panelGrid>
					    
	        			<h:panelGroup id="tabForm" rendered="#{planningMBean.showForm}">
							<h:panelGrid columns="4" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column80" border="0">
								<h:outputText value="#{messages['lb_description']}" />
								<p:inputText id="planDescription" 
											label="#{messages['lb_description_']}" 
											required="true" 
											maxlength="10"  
											value="#{planningMBean.planning.description}" 
											style="width:80px;text-align:right;" >
											<p:watermark for="planDescription" value="#{messages['lb_year']}"/>
								</p:inputText>
								<p:commandButton value="#{messages['lb_post']}" id="post" action="#{planningMBean.saveTab}" ajax="true" update=":formPlanning" styleClass="button" />  
								<p:commandButton value="#{messages['lb_cancel']}" update=":formPlanning" immediate="true" id="back" ajax="true"  styleClass="button" action="#{planningMBean.cancelTab}"/>
							</h:panelGrid>
						</h:panelGroup>
					</div>
					
					<p:tabView id="tabView" var="plan" value="#{planningMBean.planningList}" style="height:430px;" activeIndex="#{planningMBean.activedIndex}"> 
						<p:tab id="planningItemTab" title="#{plan.description}" >   
						    <p:dataTable var="planGroup" value="#{plan.plannigGroupList}" style="width:100%" id="planningGroupList"
					    		emptyMessage="#{messages['lb_empty_list']}" rows="10" rowKey="#{planGroup}" 
					    		selection="#{planningMBean.selectedPlanningGroup}">
					    		
					    		<p:column styleClass="column150"> 
					    			 <h:outputText value="#{planGroup.description.description}"/> 
					    		</p:column>
					    		
					    		<p:column>
						    		<p:dataGrid value="#{planGroup.plannigItemList}" var="item" columns="12" >
						    			<p:column> 
						    				<p:inputText value="#{item.amount}" styleClass="column100percentR">
						    					<p:ajax event="blur" process="@this" listener="#{planningMBean.saveItem}" >
													<f:setPropertyActionListener value="#{item}" target="#{planningMBean.selectedPlanningItem}" />
												</p:ajax>
						    				</p:inputText> 
								        </p:column> 
						    		</p:dataGrid>
					    		</p:column>
						    </p:dataTable>
						</p:tab>
					</p:tabView>
				</div>
			</h:form>
			
			<p:dialog header="#{messages['lb_planning_registration']}" resizable="false" widgetVar="newPlanningModal" modal="true" appendTo="@(body)" height="150" width="480">  
			    <h:form prependId="false" id="planningItem">
			    	<h:panelGroup id="panel">
	       				<br />
			       		<h:panelGrid columns="2" styleClass="boldFont" columnClasses="column120RightWithPaddingRigth,column285" border="0" >
			       		
			       			<h:outputText value="#{messages['lb_typeAccount']}" />
							<p:selectOneMenu value="#{planningMBean.typeAccount.id}" label="#{messages['lb_typeAccount_']}" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{planningMBean.typeAccounts}" var="desc" itemLabel="#{desc.name}" itemValue="#{desc}"/>
					            <p:ajax update="descriptions" event="change" listener="#{planningMBean.loadDescriptionsByTypeAccount}"/>  
					        </p:selectOneMenu>
		
					        <h:outputText value="#{messages['lb_description']}"/>
							<p:selectOneMenu id="descriptions" value="#{planningMBean.planningGroup.description.id}" label="#{messages['lb_description_']}" style="width:100%">
					            <f:selectItem itemLabel="#{messages['lb_select']}" itemValue="" />
					            <f:selectItems value="#{planningMBean.descriptions}"  var="desc" itemLabel="#{desc.description}" itemValue="#{desc}" />
					        </p:selectOneMenu>
					        
						</h:panelGrid>
						
						<br />
						<div align="center">
							<p:commandButton value="#{messages['lb_post']}" id="postItem" action="#{planningMBean.saveGroup}" oncomplete="if (args &amp;&amp; !args.validationFailed) newPlanningModal.hide();" ajax="true" update=":formPlanning" styleClass="button"/>  
							<p:commandButton value="#{messages['lb_back']}" update=":formPlanning" immediate="true" id="backItem" oncomplete="newPlanningModal.hide()" ajax="true"  styleClass="button" />
						</div>
					</h:panelGroup>
				</h:form>
			</p:dialog>
		</ui:define>
</ui:composition>
